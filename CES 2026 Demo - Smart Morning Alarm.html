<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Lunawake AI â€¢ CES 2026 Demo - Smart Morning Alarm</title>
  <style>
    :root {
      --bg0: #0a0b0f;
      --bg1: #151722;
      --bg2: #1f2332;
      --grid: rgba(255,255,255,.015);
      --grid-line: rgba(255,255,255,.04);
      --text: #e8ecf6;
      --muted: #9aa3b2;
      --wing-speed: .9s;
      --breath-speed: 5s;
      --base-offset: 0px;
      --wing-amplitude: 30px;
      --squash: .82;
      --left-shift: 0px;
      --right-shift: 0px;
    }

    * {
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
    }

    body {
      margin: 0;
      background-color: var(--bg0);
      background-image:
        linear-gradient(var(--grid) 1px, transparent 1px),
        linear-gradient(90deg, var(--grid) 1px, transparent 1px),
        radial-gradient(1400px 900px at 65% 15%, var(--bg2), var(--bg1) 60%, var(--bg0));
      background-size: 24px 24px, 24px 24px, 100% 100%;
      color: var(--text);
      font: 500 16px / 1.5 Inter, ui-sans-serif, system-ui, "Segoe UI", Roboto, Helvetica, Arial;
    }

    .wrap {
      min-height: 100%;
      display: grid;
      grid-template-rows: auto 1fr auto;
    }

    header, footer {
      padding: 16px 24px;
      opacity: 0.9;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .brand .dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: linear-gradient(145deg, rgb(255, 106, 106), rgb(255, 145, 81));
      box-shadow: rgba(255, 120, 90, 0.45) 0px 0px 18px;
    }

    .toolbar {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .stage {
      display: grid;
      place-items: center;
      padding: 12px;
    }

    .canvas {
      position: relative;
      width: min(1600px, 95vw);
      height: 70vh;
      min-height: 600px;
      aspect-ratio: 16/9; /* ç”µè§†æ¯”ä¾‹ */
      border-radius: 24px;
      background:
        linear-gradient(var(--grid-line) 1px, transparent 1px),
        linear-gradient(90deg, var(--grid-line) 1px, transparent 1px),
        linear-gradient(135deg, rgba(255, 255, 255, 0.06) 0%, rgba(255, 255, 255, 0.02) 100%);
      background-size: 20px 20px, 20px 20px, 100% 100%;
      border: 1px solid rgba(255, 255, 255, 0.15);
      box-shadow:
        rgba(0, 0, 0, 0.4) 0px 25px 70px,
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
      overflow: hidden;
      backdrop-filter: blur(20px);
    }

    .headline {
      position: absolute;
      top: 28px;
      left: 50%;
      transform: translateX(-50%);
      font-weight: 700;
      letter-spacing: -0.02em;
      text-align: center;
      font-size: clamp(22px, 3.2vw, 34px);
      white-space: nowrap;
      transition: opacity 0.8s ease-in-out, transform 0.8s ease-in-out;
    }

    .metrics {
      position: absolute;
      bottom: 22px;
      left: 22px;
      display: flex;
      gap: 14px;
      flex-wrap: wrap;
    }

    .metric {
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.18);
      padding: 12px 14px;
      border-radius: 14px;
      min-width: 130px;
      backdrop-filter: blur(10px);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    }

    .metric .label {
      color: var(--muted);
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }

    .metric .value {
      font-size: 28px;
      font-weight: 700;
      font-variant-numeric: tabular-nums;
      min-width: 85px;
      display: inline-block;
    }

    .butterfly {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .core {
      position: relative;
      width: min(350px, 22vw);
      height: min(250px, 14vw);
      display: flex;
      align-items: center;
      justify-content: center;
      transform: translateZ(0); /* å¼ºåˆ¶ç¡¬ä»¶åŠ é€Ÿ */
      backface-visibility: hidden;
    }

    .wing {
      position: absolute;
      top: 10%;
      bottom: 10%;
      width: 44%;
    }


    .wing.left {
      left: 6%;
      transform-origin: right center;
    }

    .wing.right {
      right: 6%;
      transform-origin: left center;
    }

    .core.flap .left {
      animation: wingL var(--wing-speed) cubic-bezier(0.25, 0.46, 0.45, 0.94) infinite;
      will-change: transform;
    }

    .core.flap .right {
      animation: wingR var(--wing-speed) cubic-bezier(0.25, 0.46, 0.45, 0.94) infinite;
      will-change: transform;
    }

    /* CESå±•ä½å¢å¼ºï¼šå¿ƒç‡åŒæ­¥è§†è§‰åé¦ˆ */
    .core.heart-sync {
      filter: drop-shadow(0 0 20px rgba(255, 106, 106, 0.6));
      transform: scale(1.02);
    }

    .headline.updating {
      color: rgba(255, 145, 81, 0.9);
      text-shadow: 0 0 10px rgba(255, 145, 81, 0.3);
    }

    /* ä¼˜åŒ–çš„è´è¶ç¿…è†€åŠ¨ç”» - æ›´æµç•…çš„60fps */
    @keyframes wingL {
      0% { transform: scaleX(1) rotateY(0deg) translateZ(0); }
      25% { transform: scaleX(0.85) rotateY(-8deg) translateZ(0); }
      50% { transform: scaleX(0.5) rotateY(-20deg) translateZ(0); }
      75% { transform: scaleX(0.8) rotateY(-10deg) translateZ(0); }
      100% { transform: scaleX(1) rotateY(0deg) translateZ(0); }
    }

    @keyframes wingR {
      0% { transform: scaleX(1) rotateY(0deg) translateZ(0); }
      25% { transform: scaleX(0.85) rotateY(8deg) translateZ(0); }
      50% { transform: scaleX(0.5) rotateY(20deg) translateZ(0); }
      75% { transform: scaleX(0.8) rotateY(10deg) translateZ(0); }
      100% { transform: scaleX(1) rotateY(0deg) translateZ(0); }
    }

    /* ä¸ºç”µè§†æ˜¾ç¤ºä¼˜åŒ–æ€§èƒ½ */
    .wing svg {
      width: 100%;
      height: 100%;
      display: block;
      transform: translateZ(0); /* å¼ºåˆ¶ç¡¬ä»¶åŠ é€Ÿ */
      backface-visibility: hidden;
    }

    .aura {
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      filter: blur(28px);
      opacity: 0.6;
      pointer-events: none;
    }

    .aura .blob {
      width: 180px;
      height: 180px;
      border-radius: 50%;
      background: radial-gradient(circle at 40% 40%, rgba(255, 145, 81, 0.75), rgba(255, 106, 106, 0.5), transparent 70%);
      animation: breath var(--breath-speed) ease-in-out infinite;
    }

    @keyframes breath {
      0% { transform: scale(0.92); }
      50% { transform: scale(1.06); }
      100% { transform: scale(0.92); }
    }

    .hint {
      position: absolute;
      bottom: 22px;
      right: 22px;
    }

    .sleepcard {
      position: absolute;
      top: 50%;
      right: 22px;
      transform: translateY(-50%);
      display: grid;
      gap: 8px;
      min-width: 220px;
    }

    .sleepcard .row {
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.18);
      padding: 8px 12px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      backdrop-filter: blur(10px);
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
    }

    .sleepcard .k {
      color: var(--muted);
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }

    .sleepcard .v {
      font-weight: 700;
      font-variant-numeric: tabular-nums;
      min-width: 70px;
      display: inline-block;
      text-align: right;
    }

    .chip {
      background: rgba(255, 255, 255, 0.06);
      border: 1px solid rgba(255, 255, 255, 0.15);
      padding: 8px 12px;
      border-radius: 20px;
      font-size: 12px;
      color: var(--muted);
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand"><span class="dot"></span><strong>Lunawake AI â€¢ Smart Morning Alarm Clock</strong></div>
      <div class="toolbar"></div>
    </header>

    <main class="stage">
      <section class="canvas" id="canvas">
        <div class="headline" id="headline">Sleep better with Lunawake</div>

        <div class="butterfly">
          <div class="aura"><div class="blob"></div></div>
          <div class="core flap" id="core">
            <div class="wing left">
              <svg viewBox="0 0 40 62" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet">
                <path id="wingPathL" d="M15.1544 61.8112C32.16 57.4157 42.5533 40.2467 38.3686 23.4632C34.1838 6.6796 17.0056 -3.36292 0 1.03257C0 1.03257 3.39183 14.6385 7.57659 31.4221C11.7614 48.2056 15.1544 61.8112 15.1544 61.8112Z" fill="url(#gradWingL)"></path>
                <defs>
                  <linearGradient id="gradWingL" x1="0" y1="0" x2="1" y2="1">
                    <stop offset="0%" stop-color="#FD975A"></stop>
                    <stop offset="100%" stop-color="#F34444"></stop>
                  </linearGradient>
                </defs>
              </svg>
            </div>
            <div class="wing right">
              <svg viewBox="0 0 40 62" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet">
                <path id="wingPathR" d="M24.8456 61.8112C7.84 57.4157 -2.5533 40.2467 1.6314 23.4632C5.8162 6.6796 22.9944 -3.36292 40 1.03257C40 1.03257 36.6082 14.6385 32.4234 31.4221C28.2386 48.2056 24.8456 61.8112 24.8456 61.8112Z" fill="url(#gradWingR)"></path>
                <defs>
                  <linearGradient id="gradWingR" x1="1" y1="0" x2="0" y2="1">
                    <stop offset="0%" stop-color="#FD975A"></stop>
                    <stop offset="100%" stop-color="#F34444"></stop>
                  </linearGradient>
                </defs>
              </svg>
            </div>
          </div>
        </div>

        <div class="metrics">
          <div class="metric"><div class="label">Heart rate</div><div class="value"><span id="hr">69</span> bpm</div></div>
          <div class="metric"><div class="label">Respiratory rate</div><div class="value"><span id="br">18</span> rpm</div></div>
        </div>

        <div class="sleepcard" id="sleepcard">
          <div class="row"><span class="k">Sleep Time</span><span class="v" id="sleepTime">11:08 pm</span></div>
          <div class="row"><span class="k">Wake Window</span><span class="v" id="wakeWindow">6:40â€“7:10 am</span></div>
          <div class="row"><span class="k">Duration</span><span class="v" id="duration">7h 32m</span></div>
          <div class="row"><span class="k">Deep Sleep</span><span class="v" id="deepSleep">1h 32m</span></div>
          <div class="row"><span class="k">Time to Sleep</span><span class="v" id="tts">13m</span></div>
        </div>

        <div class="hint chip">
          <span id="modeIndicator">Heart rate synced butterfly â€¢ AI sleep alarm demo</span> â€¢
          <button id="demoButton" style="background: none; border: 1px solid rgba(255,255,255,0.3); color: inherit; padding: 4px 8px; border-radius: 8px; font-size: 11px; cursor: pointer;">Demo Mode</button>
        </div>
      </section>
    </main>

    <footer>
      <small>Â© <span id="year">2025</span> Lunawake â€” No camera. No raw audio recording. Vital signs processed locally; encrypted cloud backup optional.</small>
    </footer>
  </div>

  <script>
    // Update year
    document.getElementById('year').textContent = new Date().getFullYear();

    // å¿ƒç‡å’Œå‘¼å¸æ•°æ®ç®¡ç†
    let currentHeartRate = 69;
    let currentBreathRate = 18;
    let breathingPhase = 0;

    // æ›´æ–°ç¿…è†€æ‰‘åŠ¨èŠ‚å¥ä¸å¿ƒç‡åŒæ­¥ï¼ˆæ›´è‡ªç„¶çš„å‘¼å¸èŠ‚å¥ï¼‰
    let targetFlutterDuration = 4.0; // ç›®æ ‡æ‰‘åŠ¨æ—¶é•¿
    let currentFlutterDuration = 4.0; // å½“å‰æ‰‘åŠ¨æ—¶é•¿
    let lastUpdateTime = Date.now();

    // ç”µè§†ä¼˜åŒ–ï¼šè¶…æµç•…çš„å¿ƒç‡åŒæ­¥ç®—æ³•
    function updateWingFlutterToHeartRate() {
      const heartRateElement = document.getElementById('hr');
      const heartRate = parseFloat(heartRateElement.textContent);
      const coreElement = document.getElementById('core');

      // ç›´æ¥æ˜ å°„å¿ƒç‡åˆ°æ‰‡åŠ¨é€Ÿåº¦ï¼Œé’ˆå¯¹ç”µè§†æ˜¾ç¤ºä¼˜åŒ–
      // å¿ƒç‡èŒƒå›´: 60-100 bpm -> æ‰‡åŠ¨é€Ÿåº¦: 0.8-1.8ç§’ï¼ˆç¨æ…¢é¿å…å¡é¡¿ï¼‰
      let flutterSpeed;
      if (heartRate < 60) {
        flutterSpeed = 1.8;
      } else if (heartRate > 100) {
        flutterSpeed = 0.8;
      } else {
        // çº¿æ€§æ˜ å°„: 60bpm->1.8s, 100bpm->0.8s
        flutterSpeed = 1.8 - ((heartRate - 60) / 40) * 1.0;
      }

      // å‡å°‘è‡ªç„¶å˜åŒ–ï¼Œç¡®ä¿ç”µè§†æ˜¾ç¤ºçš„ç¨³å®šæ€§
      const naturalVariation = 1 + (Math.sin(Date.now() / 8000) * 0.03);
      const finalSpeed = flutterSpeed * naturalVariation;

      // ä½¿ç”¨requestAnimationFrameç¡®ä¿æµç•…æ›´æ–°
      requestAnimationFrame(() => {
        document.documentElement.style.setProperty('--wing-speed', `${finalSpeed.toFixed(3)}s`);
      });

      // å±•ä½å¢å¼ºï¼šå¿ƒç‡åŒæ­¥è§†è§‰åé¦ˆ
      if (heartRate > 75) {
        coreElement.classList.add('heart-sync');
      } else {
        coreElement.classList.remove('heart-sync');
      }
    }

    // æ·»åŠ çœŸå®çš„å¿ƒç‡å˜å¼‚æ€§
    function addRealisticHeartRateVariability() {
      setInterval(() => {
        const baseHeartRate = 69; // åŸºå‡†å¿ƒç‡
        const currentTime = Date.now();

        // å‘¼å¸æ€§çª¦æ€§å¿ƒå¾‹ä¸é½
        const breathCycleDuration = (60 / currentBreathRate) * 1000;
        breathingPhase = ((currentTime % breathCycleDuration) / breathCycleDuration) * 2 * Math.PI;
        const respiratoryVariation = Math.sin(breathingPhase) * 2; // Â±2 bpm

        // è‡ªç„¶å¿ƒç‡å˜å¼‚æ€§
        const hrv = (Math.random() - 0.5) * 3; // Â±1.5 bpmçš„éšæœºå˜åŒ–

        // é•¿æœŸè¶‹åŠ¿å˜åŒ–
        const longTermTrend = Math.sin(currentTime / 25000) * 1.5; // 25ç§’å‘¨æœŸ

        // è®¡ç®—æœ€ç»ˆå¿ƒç‡
        const finalHeartRate = Math.max(50, Math.min(100,
          baseHeartRate + respiratoryVariation + hrv + longTermTrend
        ));

        currentHeartRate = finalHeartRate;

        // æ›´æ–°æ˜¾ç¤ºï¼ˆä¿ç•™1ä½å°æ•°ï¼‰
        document.getElementById('hr').textContent = finalHeartRate.toFixed(1);

        // å®æ—¶æ›´æ–°ç¿…è†€æ‰‘åŠ¨é€Ÿåº¦
        updateWingFlutterToHeartRate();

        // æ›´æ–°æ™ºèƒ½æ ‡é¢˜
        updateSmartHeadline(finalHeartRate);

      }, 200); // æ¯200msæ›´æ–°ä¸€æ¬¡
    }

    // å¢å¼ºçš„å‘¼å¸é¢‘ç‡å˜å¼‚æ€§
    function addEnhancedBreathingVariability() {
      setInterval(() => {
        const baseBreathRate = 18;

        // æ·±åº¦å‘¼å¸å‘¨æœŸå˜åŒ–ï¼ˆæ¨¡æ‹Ÿæ·±æµ…å‘¼å¸äº¤æ›¿ï¼‰
        const deepBreathCycle = Math.sin(Date.now() / 15000) * 1.2; // 15ç§’å‘¨æœŸ

        // ä¸å¿ƒç‡çš„ç”Ÿç†è€¦åˆ
        const heartRateCoupling = (currentHeartRate - 69) * 0.05;

        // ç¡çœ çŠ¶æ€å½±å“ï¼ˆæ¨¡æ‹Ÿæ·±ç¡æ—¶å‘¼å¸æ›´æ…¢æ›´è§„å¾‹ï¼‰
        const sleepEffect = Math.sin(Date.now() / 120000) * -0.8; // 2åˆ†é’Ÿå‘¨æœŸï¼Œæ¨¡æ‹Ÿç¡çœ æ·±åº¦å˜åŒ–

        // è‡ªç„¶éšæœºå˜åŒ–
        const naturalVariation = (Math.random() - 0.5) * 1.2;

        // å‘¼å¸ç›¸ä½åŒæ­¥æ•ˆåº”
        const breathPhaseEffect = Math.cos(breathingPhase * 0.5) * 0.3;

        const finalBreathRate = Math.max(12, Math.min(24,
          baseBreathRate + deepBreathCycle + heartRateCoupling + sleepEffect + naturalVariation + breathPhaseEffect
        ));

        currentBreathRate = finalBreathRate;
        document.getElementById('br').textContent = finalBreathRate.toFixed(1);

      }, 2000); // æ¯2ç§’æ›´æ–°å‘¼å¸é¢‘ç‡
    }

    // ç¡çœ æ•°æ®ç®¡ç†
    let sleepData = {
      sleepTime: "11:08 pm",
      wakeWindow: "6:40â€“7:10 am",
      duration: "7h 32m",
      deepSleep: "1h 32m",
      timeToSleep: "13m"
    };

    // CESå±•ä½ä¸“ç”¨ï¼šAIæ™¨é—´é—¹é’Ÿå”¤é†’æ¶ˆæ¯åº“
    const smartMessages = {
      detecting: [
        "ğŸ“¡ AI Sleep Monitor detecting your presence...",
        "ğŸ” Lunawake is scanning your vital signs",
        "âš™ï¸ Calibrating to your unique sleep rhythm",
        "ğŸ‘ï¸ Millimeter wave sensor activated"
      ],
      restful: [
        "ğŸŒ… Rise and shine! Your calm heart rate shows perfect sleep",
        "â˜€ï¸ Good morning, sleepyhead! Time for a gentle wake-up",
        "ğŸ˜Œ Wakey wakey! Your peaceful rhythm deserves a soft alarm",
        "ğŸŒ¸ Morning bloom! Your rested heart beats beautifully",
        "ğŸ•Šï¸ Gentle wake-up call for your serene sleep pattern"
      ],
      elevated: [
        "â° Good morning! Your active heart suggests you're ready to rise",
        "ğŸš€ Wake-up boost! Your elevated pulse means energy awaits",
        "âš¡ Morning charge! Your heart rate shows you're primed for action",
        "ğŸ”¥ Power wake-up! Your vitals indicate high energy reserves",
        "ğŸ’ª Strong morning! Your elevated pulse means go-time"
      ],
      active: [
        "ğŸƒâ€â™€ï¸ Already moving? Perfect time for your personalized alarm!",
        "ğŸ¯ Morning warrior! Your heart rate shows you're ready to conquer",
        "â­ Superstar wake-up! Your active vitals mean it's showtime",
        "ğŸŒŸ Dynamic morning! Your pulse pattern suggests peak readiness",
        "ğŸš€ Blast-off wake-up! Your heart rate indicates launch mode"
      ],
      leaving: [
        "ğŸŒ… Early bird wake-up! Your rhythm shows dawn patrol energy",
        "ğŸƒâ€â™‚ï¸ Sprint start! Your heart rate suggests morning jog time",
        "â˜• Coffee run wake-up! Your pulse indicates caffeine calling",
        "ğŸ’¼ Work mode activated! Your vitals show productivity peaks",
        "ğŸŒ Adventure wake-up! Your heart rate screams 'seize the day'"
      ],
      returning: [
        "ğŸ›ï¸ Back to bed? Your heart rate suggests snooze mode",
        "ğŸ˜´ Cozy wake-up! Your settled pulse means comfort zone time",
        "ğŸ§˜â€â™€ï¸ Zen morning! Your calm rhythm suggests mindful wake-up",
        "ğŸŒŠ Flow state wake-up! Your steady heart beats with the tide",
        "ğŸƒ Natural wake-up! Your gentle rhythm follows nature's pace"
      ],
      irregular: [
        "ğŸ¼ Unique rhythm! Your irregular heartbeat needs a custom alarm",
        "ğŸ­ Dynamic wake-up! Your varied pulse creates personalized timing",
        "ğŸ¨ Artistic morning! Your heart paints its own wake-up pattern",
        "ğŸŒˆ Rainbow wake-up! Your diverse rhythm spans every mood",
        "ğŸª Carnival morning! Your playful heartbeat sets the celebration"
      ],
      peaceful: [
        "ğŸ˜‡ Angelic wake-up! Your peaceful heart deserves heaven's alarm",
        "ğŸŒ™ Dream transition! Your calm pulse guides gentle awakening",
        "âœ¨ Magic morning! Your serene heartbeat creates perfect timing",
        "ğŸ•¯ï¸ Candlelight wake-up! Your soft rhythm glows into morning",
        "ğŸ¦‹ Butterfly emergence! Your gentle pulse mirrors transformation"
      ]
    };

    let currentMessageCategory = "detecting";
    let lastHeartRatePattern = [];
    let messageChangeTimer = 0;
    let demoMode = false;
    let demoHeartRates = [65, 72, 68, 85, 78, 63, 90, 75]; // æ¼”ç¤ºç”¨å¿ƒç‡åºåˆ—
    let demoIndex = 0;
    let demoInterval;

    // åŸºäºå¿ƒç‡æ¨¡æ‹Ÿç¡çœ æ•°æ®çš„ç¼“æ…¢å˜åŒ–
    function simulateSleepDataBasedOnHeartRate() {
      setInterval(() => {
        const avgHeartRate = currentHeartRate;

        // æ ¹æ®å¿ƒç‡è®¡ç®—ç¡çœ è´¨é‡æŒ‡æ ‡
        const heartRateStress = Math.abs(avgHeartRate - 65); // 65æ˜¯ç†æƒ³ç¡çœ å¿ƒç‡
        const sleepQuality = Math.max(0.3, 1 - heartRateStress / 30); // 0.3-1.0

        // åŠ¨æ€è°ƒæ•´æ·±ç¡æ—¶é—´ï¼ˆå¿ƒç‡è¶Šç¨³å®šï¼Œæ·±ç¡è¶Šå¤šï¼‰
        const baseDeepSleep = 92; // åŸºç¡€92åˆ†é’Ÿ
        const deepSleepVariation = (sleepQuality - 0.5) * 40; // Â±20åˆ†é’Ÿ
        const finalDeepSleep = Math.max(45, Math.min(140, baseDeepSleep + deepSleepVariation));

        const deepHours = Math.floor(finalDeepSleep / 60);
        const deepMinutes = Math.round(finalDeepSleep % 60);
        sleepData.deepSleep = `${deepHours}h ${deepMinutes}m`;

        // åŠ¨æ€è°ƒæ•´å…¥ç¡æ—¶é—´ï¼ˆå¿ƒç‡è¶Šä½è¶Šå¿«å…¥ç¡ï¼‰
        const baseTTS = 13; // åŸºç¡€13åˆ†é’Ÿ
        const ttsVariation = (avgHeartRate - 65) * 0.3; // å¿ƒç‡æ¯é«˜1bpmå¤š0.3åˆ†é’Ÿ
        const finalTTS = Math.max(3, Math.min(25, baseTTS + ttsVariation));
        sleepData.timeToSleep = `${Math.round(finalTTS)}m`;

        // åŠ¨æ€è°ƒæ•´æ€»ç¡çœ æ—¶é•¿
        const baseDuration = 452; // åŸºç¡€7h32m = 452åˆ†é’Ÿ
        const durationVariation = sleepQuality * 30 - 15; // Â±15åˆ†é’Ÿ
        const finalDuration = Math.max(360, Math.min(540, baseDuration + durationVariation));

        const totalHours = Math.floor(finalDuration / 60);
        const totalMinutes = Math.round(finalDuration % 60);
        sleepData.duration = `${totalHours}h ${totalMinutes}m`;

        // æ›´æ–°æ˜¾ç¤º
        document.getElementById('deepSleep').textContent = sleepData.deepSleep;
        document.getElementById('tts').textContent = sleepData.timeToSleep;
        document.getElementById('duration').textContent = sleepData.duration;

      }, 15000); // æ¯15ç§’æ›´æ–°ä¸€æ¬¡ç¡çœ æ•°æ®
    }

    // æ¨¡æ‹Ÿæ—¶é—´ç›¸å…³çš„ç¡çœ æ•°æ®å˜åŒ–ï¼ˆéå®æ—¶ä½†æœ‰è§„å¾‹ï¼‰
    function simulateTimeBasedSleepUpdates() {
      setInterval(() => {
        const now = new Date();
        const currentMinutes = now.getHours() * 60 + now.getMinutes();

        // æ¨¡æ‹Ÿç¡çœ æ—¶é—´çš„å¾®è°ƒï¼ˆåŸºäºå½“å‰å¿ƒç‡è¶‹åŠ¿ï¼‰
        const heartRateTrend = (currentHeartRate - 69) / 10; // æ ‡å‡†åŒ–å¿ƒç‡è¶‹åŠ¿

        // ç¡çœ æ—¶é—´å¾®è°ƒï¼ˆÂ±5åˆ†é’ŸèŒƒå›´ï¼‰
        const baseHour = 23;
        const baseMinute = 8;
        const timeAdjustment = Math.round(heartRateTrend * 3); // Â±3åˆ†é’Ÿè°ƒæ•´

        let adjustedMinute = baseMinute + timeAdjustment;
        let adjustedHour = baseHour;

        if (adjustedMinute < 0) {
          adjustedMinute += 60;
          adjustedHour -= 1;
        } else if (adjustedMinute >= 60) {
          adjustedMinute -= 60;
          adjustedHour += 1;
        }

        // æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤º
        const sleepTimeStr = `${adjustedHour === 12 ? 12 : adjustedHour % 12}:${adjustedMinute.toString().padStart(2, '0')} ${adjustedHour >= 12 ? 'pm' : 'am'}`;
        sleepData.sleepTime = sleepTimeStr;

        // ç›¸åº”è°ƒæ•´å”¤é†’çª—å£
        const wakeHour = 6 + Math.round(timeAdjustment / 10); // å¾®è°ƒå”¤é†’æ—¶é—´
        const wakeEndHour = wakeHour + 1;
        sleepData.wakeWindow = `${wakeHour}:40â€“${wakeEndHour}:10 am`;

        // æ›´æ–°æ˜¾ç¤º
        document.getElementById('sleepTime').textContent = sleepData.sleepTime;
        document.getElementById('wakeWindow').textContent = sleepData.wakeWindow;

      }, 45000); // æ¯45ç§’æ›´æ–°ä¸€æ¬¡æ—¶é—´ç›¸å…³æ•°æ®
    }

    // CESå±•ä½ä¼˜åŒ–ï¼šæ›´æ•æ„Ÿçš„å¿ƒç‡å“åº”ç³»ç»Ÿ
    function updateSmartHeadline(currentHR) {
      // è®°å½•å¿ƒç‡æ¨¡å¼ç”¨äºåˆ†æï¼ˆå±•ä½ç¯å¢ƒä¸‹ç¼©çŸ­å†å²è®°å½•ï¼‰
      lastHeartRatePattern.push(currentHR);
      if (lastHeartRatePattern.length > 10) { // å‡å°‘åˆ°10ä¸ªæ•°æ®ç‚¹ï¼Œæ›´å¿«å“åº”
        lastHeartRatePattern.shift();
      }

      messageChangeTimer++;

      // æ›´é¢‘ç¹çš„æ›´æ–°(æ¯15æ¬¡æ›´æ–°çº¦3ç§’)ï¼Œæé«˜å±•ä½äº’åŠ¨æ€§
      if (messageChangeTimer >= 15) {
        messageChangeTimer = 0;
        analyzeHeartRatePattern();
      }
    }

    // CESå±•ä½ä¼˜åŒ–ï¼šæ›´æ•æ„Ÿçš„å¿ƒç‡æ¨¡å¼åˆ†æ
    function analyzeHeartRatePattern() {
      if (lastHeartRatePattern.length < 5) return; // æ›´å°‘æ•°æ®ç‚¹å³å¯åˆ†æ

      const recentHR = lastHeartRatePattern.slice(-5); // åªçœ‹æœ€è¿‘5ä¸ªæ•°æ®ç‚¹
      const avgHR = recentHR.reduce((a, b) => a + b, 0) / recentHR.length;
      const hrVariability = Math.max(...recentHR) - Math.min(...recentHR);
      const trend = recentHR[recentHR.length - 1] - recentHR[0];

      let newCategory = currentMessageCategory;

      // å±•ä½ç¯å¢ƒä¼˜åŒ–çš„çŠ¶æ€åˆ¤æ–­ï¼ˆæ›´å®½æ¾çš„é˜ˆå€¼ï¼‰
      if (avgHR < 60) {
        newCategory = "peaceful";
      } else if (avgHR < 70 && hrVariability < 8) {
        newCategory = "restful";
      } else if (avgHR > 80) {
        if (trend > 3) {
          newCategory = "active"; // é™ä½è¶‹åŠ¿é˜ˆå€¼
        } else if (trend < -3) {
          newCategory = "returning";
        } else {
          newCategory = "elevated";
        }
      } else if (avgHR > 90) {
        newCategory = "leaving";
      } else if (hrVariability > 10) { // é™ä½å˜å¼‚æ€§é˜ˆå€¼
        newCategory = "irregular";
      } else {
        newCategory = "restful"; // é»˜è®¤çŠ¶æ€
      }

      // å±•ä½ç¯å¢ƒä¸‹æ›´é¢‘ç¹æ›´æ–°æ¶ˆæ¯ï¼ˆ60%æ¦‚ç‡ï¼‰
      if (newCategory !== currentMessageCategory || Math.random() > 0.4) {
        currentMessageCategory = newCategory;
        updateHeadlineMessage();
      }
    }

    function updateHeadlineMessage() {
      const messages = smartMessages[currentMessageCategory];
      const randomMessage = messages[Math.floor(Math.random() * messages.length)];

      const headlineElement = document.getElementById('headline');

      // å±•ä½å¢å¼ºï¼šæ›´æ˜æ˜¾çš„æ¶ˆæ¯æ›´æ–°æ•ˆæœ
      headlineElement.classList.add('updating');
      headlineElement.style.opacity = '0.3';
      headlineElement.style.transform = 'translateX(-50%) translateY(-5px)';

      setTimeout(() => {
        headlineElement.textContent = randomMessage;
        // æ·¡å…¥æ•ˆæœ
        headlineElement.style.opacity = '1';
        headlineElement.style.transform = 'translateX(-50%) translateY(0)';

        // ç§»é™¤æ›´æ–°æ ·å¼
        setTimeout(() => {
          headlineElement.classList.remove('updating');
        }, 1000);
      }, 600); // ç¨å¿«çš„åˆ‡æ¢é€Ÿåº¦
    }

    // CESå±•ä½æ¼”ç¤ºæ¨¡å¼åŠŸèƒ½
    function toggleDemoMode() {
      demoMode = !demoMode;
      const button = document.getElementById('demoButton');
      const indicator = document.getElementById('modeIndicator');

      if (demoMode) {
        button.textContent = 'Stop Demo';
        button.style.backgroundColor = 'rgba(255, 106, 106, 0.3)';
        indicator.textContent = 'DEMO MODE: Simulating different heart rates';
        startDemo();
      } else {
        button.textContent = 'Demo Mode';
        button.style.backgroundColor = 'transparent';
        indicator.textContent = 'Heart rate synced butterfly â€¢ AI sleep alarm demo';
        stopDemo();
      }
    }

    function startDemo() {
      // æ¯3ç§’åˆ‡æ¢ä¸€ä¸ªæ¼”ç¤ºå¿ƒç‡
      demoInterval = setInterval(() => {
        const demoHR = demoHeartRates[demoIndex];
        document.getElementById('hr').textContent = demoHR;
        currentHeartRate = demoHR;

        // å¼ºåˆ¶æ›´æ–°è´è¶æ‰‡åŠ¨å’Œæ¶ˆæ¯
        updateWingFlutterToHeartRate();
        updateSmartHeadline(demoHR);

        demoIndex = (demoIndex + 1) % demoHeartRates.length;
      }, 3000);
    }

    function stopDemo() {
      if (demoInterval) {
        clearInterval(demoInterval);
      }
      // æ¢å¤æ­£å¸¸æ¨¡æ‹Ÿ
      addRealisticHeartRateVariability();
    }

    // åˆå§‹åŒ–æ‰€æœ‰åŠŸèƒ½
    updateWingFlutterToHeartRate();
    addRealisticHeartRateVariability();
    addEnhancedBreathingVariability();
    simulateSleepDataBasedOnHeartRate();
    simulateTimeBasedSleepUpdates();

    // ç»‘å®šæ¼”ç¤ºæ¨¡å¼æŒ‰é’®å’Œé”®ç›˜å¿«æ·é”®
    document.getElementById('demoButton').addEventListener('click', toggleDemoMode);

    // å±•ä½å¿«æ·é”®ï¼šæŒ‰ 'D' é”®å¿«é€Ÿåˆ‡æ¢æ¼”ç¤ºæ¨¡å¼
    document.addEventListener('keydown', function(event) {
      if (event.key === 'd' || event.key === 'D') {
        toggleDemoMode();
      }
      // æŒ‰ 'R' é”®é‡ç½®åˆ°åˆå§‹çŠ¶æ€
      if (event.key === 'r' || event.key === 'R') {
        location.reload();
      }
    });

    // åˆå§‹è®¾ç½®ä¸€ä¸ªæ¶ˆæ¯
    setTimeout(() => {
      updateHeadlineMessage();
    }, 1000);
  </script>
</body>
</html>