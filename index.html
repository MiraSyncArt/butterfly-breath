<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Lunawake â€¢ Butterfly Breath Live</title>
  <style>
    :root {
      --bg0: #0a0b0f;
      --bg1: #151722;
      --bg2: #1f2332;
      --grid: rgba(255,255,255,.015);
      --grid-line: rgba(255,255,255,.04);
      --text: #e8ecf6;
      --muted: #9aa3b2;
      --wing-speed: .9s;
      --breath-speed: 5s;
      --base-offset: 0px;
      --wing-amplitude: 30px;
      --squash: .82;
      --left-shift: 0px;
      --right-shift: 0px;
    }

    * {
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
    }

    body {
      margin: 0;
      background-color: var(--bg0);
      background-image:
        linear-gradient(var(--grid) 1px, transparent 1px),
        linear-gradient(90deg, var(--grid) 1px, transparent 1px),
        radial-gradient(1400px 900px at 65% 15%, var(--bg2), var(--bg1) 60%, var(--bg0));
      background-size: 24px 24px, 24px 24px, 100% 100%;
      color: var(--text);
      font: 500 16px / 1.5 Inter, ui-sans-serif, system-ui, "Segoe UI", Roboto, Helvetica, Arial;
    }

    .wrap {
      min-height: 100%;
      display: grid;
      grid-template-rows: auto 1fr auto;
    }

    header, footer {
      padding: 16px 24px;
      opacity: 0.9;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .brand .dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: linear-gradient(145deg, rgb(255, 106, 106), rgb(255, 145, 81));
      box-shadow: rgba(255, 120, 90, 0.45) 0px 0px 18px;
    }

    .toolbar {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .stage {
      display: grid;
      place-items: center;
      padding: 12px;
    }

    .canvas {
      position: relative;
      width: min(1200px, 92vw);
      height: 64vh;
      min-height: 420px;
      border-radius: 24px;
      background:
        linear-gradient(var(--grid-line) 1px, transparent 1px),
        linear-gradient(90deg, var(--grid-line) 1px, transparent 1px),
        linear-gradient(135deg, rgba(255, 255, 255, 0.06) 0%, rgba(255, 255, 255, 0.02) 100%);
      background-size: 20px 20px, 20px 20px, 100% 100%;
      border: 1px solid rgba(255, 255, 255, 0.15);
      box-shadow:
        rgba(0, 0, 0, 0.4) 0px 25px 70px,
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
      overflow: hidden;
      backdrop-filter: blur(20px);
    }

    .headline {
      position: absolute;
      top: 28px;
      left: 50%;
      transform: translateX(-50%);
      font-weight: 700;
      letter-spacing: -0.02em;
      text-align: center;
      font-size: clamp(22px, 3.2vw, 34px);
      white-space: nowrap;
      transition: opacity 0.8s ease-in-out, transform 0.8s ease-in-out;
    }

    .metrics {
      position: absolute;
      bottom: 22px;
      left: 22px;
      display: flex;
      gap: 14px;
      flex-wrap: wrap;
    }

    .metric {
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.18);
      padding: 12px 14px;
      border-radius: 14px;
      min-width: 130px;
      backdrop-filter: blur(10px);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    }

    .metric .label {
      color: var(--muted);
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }

    .metric .value {
      font-size: 28px;
      font-weight: 700;
      font-variant-numeric: tabular-nums;
      min-width: 85px;
      display: inline-block;
    }

    .butterfly {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .core {
      position: relative;
      width: min(280px, 28vw);
      height: min(200px, 20vw);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .wing {
      position: absolute;
      top: 10%;
      bottom: 10%;
      width: 44%;
    }

    .wing svg {
      width: 100%;
      height: 100%;
      display: block;
    }

    .wing.left {
      left: 6%;
      transform-origin: right center;
    }

    .wing.right {
      right: 6%;
      transform-origin: left center;
    }

    .core.flap .left {
      animation: wingL var(--wing-speed) cubic-bezier(0.4, 0.0, 0.6, 1) infinite;
    }

    .core.flap .right {
      animation: wingR var(--wing-speed) cubic-bezier(0.4, 0.0, 0.6, 1) infinite;
    }

    @keyframes wingL {
      0% { transform: scaleX(1) rotateY(0deg); }
      20% { transform: scaleX(0.9) rotateY(-5deg); }
      40% { transform: scaleX(0.6) rotateY(-15deg); }
      60% { transform: scaleX(0.8) rotateY(-8deg); }
      80% { transform: scaleX(0.95) rotateY(-2deg); }
      100% { transform: scaleX(1) rotateY(0deg); }
    }

    @keyframes wingR {
      0% { transform: scaleX(1) rotateY(0deg); }
      20% { transform: scaleX(0.9) rotateY(5deg); }
      40% { transform: scaleX(0.6) rotateY(15deg); }
      60% { transform: scaleX(0.8) rotateY(8deg); }
      80% { transform: scaleX(0.95) rotateY(2deg); }
      100% { transform: scaleX(1) rotateY(0deg); }
    }

    .aura {
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      filter: blur(28px);
      opacity: 0.6;
      pointer-events: none;
    }

    .aura .blob {
      width: 180px;
      height: 180px;
      border-radius: 50%;
      background: radial-gradient(circle at 40% 40%, rgba(255, 145, 81, 0.75), rgba(255, 106, 106, 0.5), transparent 70%);
      animation: breath var(--breath-speed) ease-in-out infinite;
    }

    @keyframes breath {
      0% { transform: scale(0.92); }
      50% { transform: scale(1.06); }
      100% { transform: scale(0.92); }
    }

    .hint {
      position: absolute;
      bottom: 22px;
      right: 22px;
    }

    .sleepcard {
      position: absolute;
      top: 50%;
      right: 22px;
      transform: translateY(-50%);
      display: grid;
      gap: 8px;
      min-width: 220px;
    }

    .sleepcard .row {
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.18);
      padding: 8px 12px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      backdrop-filter: blur(10px);
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
    }

    .sleepcard .k {
      color: var(--muted);
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }

    .sleepcard .v {
      font-weight: 700;
      font-variant-numeric: tabular-nums;
      min-width: 70px;
      display: inline-block;
      text-align: right;
    }

    .chip {
      background: rgba(255, 255, 255, 0.06);
      border: 1px solid rgba(255, 255, 255, 0.15);
      padding: 8px 12px;
      border-radius: 20px;
      font-size: 12px;
      color: var(--muted);
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand"><span class="dot"></span><strong>Lunawake â€¢ Butterfly Breath Live</strong></div>
      <div class="toolbar"></div>
    </header>

    <main class="stage">
      <section class="canvas" id="canvas">
        <div class="headline" id="headline">Sleep better with Lunawake</div>

        <div class="butterfly">
          <div class="aura"><div class="blob"></div></div>
          <div class="core flap" id="core">
            <div class="wing left">
              <svg viewBox="0 0 40 62" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet">
                <path id="wingPathL" d="M15.1544 61.8112C32.16 57.4157 42.5533 40.2467 38.3686 23.4632C34.1838 6.6796 17.0056 -3.36292 0 1.03257C0 1.03257 3.39183 14.6385 7.57659 31.4221C11.7614 48.2056 15.1544 61.8112 15.1544 61.8112Z" fill="url(#gradWingL)"></path>
                <defs>
                  <linearGradient id="gradWingL" x1="0" y1="0" x2="1" y2="1">
                    <stop offset="0%" stop-color="#FD975A"></stop>
                    <stop offset="100%" stop-color="#F34444"></stop>
                  </linearGradient>
                </defs>
              </svg>
            </div>
            <div class="wing right">
              <svg viewBox="0 0 40 62" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet">
                <path id="wingPathR" d="M24.8456 61.8112C7.84 57.4157 -2.5533 40.2467 1.6314 23.4632C5.8162 6.6796 22.9944 -3.36292 40 1.03257C40 1.03257 36.6082 14.6385 32.4234 31.4221C28.2386 48.2056 24.8456 61.8112 24.8456 61.8112Z" fill="url(#gradWingR)"></path>
                <defs>
                  <linearGradient id="gradWingR" x1="1" y1="0" x2="0" y2="1">
                    <stop offset="0%" stop-color="#FD975A"></stop>
                    <stop offset="100%" stop-color="#F34444"></stop>
                  </linearGradient>
                </defs>
              </svg>
            </div>
          </div>
        </div>

        <div class="metrics">
          <div class="metric"><div class="label">Heart rate</div><div class="value"><span id="hr">69</span> bpm</div></div>
          <div class="metric"><div class="label">Respiratory rate</div><div class="value"><span id="br">18</span> rpm</div></div>
        </div>

        <div class="sleepcard" id="sleepcard">
          <div class="row"><span class="k">Sleep Time</span><span class="v" id="sleepTime">11:08 pm</span></div>
          <div class="row"><span class="k">Wake Window</span><span class="v" id="wakeWindow">6:40â€“7:10 am</span></div>
          <div class="row"><span class="k">Duration</span><span class="v" id="duration">7h 32m</span></div>
          <div class="row"><span class="k">Deep Sleep</span><span class="v" id="deepSleep">1h 32m</span></div>
          <div class="row"><span class="k">Time to Sleep</span><span class="v" id="tts">13m</span></div>
        </div>

        <div class="hint chip">Scan for press kit â€¢ preorder â€¢ tech notes</div>
      </section>
    </main>

    <footer>
      <small>Â© <span id="year">2025</span> Lunawake â€” No camera. No raw audio recording. Vital signs processed locally; encrypted cloud backup optional.</small>
    </footer>
  </div>

  <script>
    // Update year
    document.getElementById('year').textContent = new Date().getFullYear();

    // å¿ƒç‡å’Œå‘¼å¸æ•°æ®ç®¡ç†
    let currentHeartRate = 69;
    let currentBreathRate = 18;
    let breathingPhase = 0;

    // æ›´æ–°ç¿…è†€æ‰‘åŠ¨èŠ‚å¥ä¸å¿ƒç‡åŒæ­¥ï¼ˆæ›´è‡ªç„¶çš„å‘¼å¸èŠ‚å¥ï¼‰
    let targetFlutterDuration = 4.0; // ç›®æ ‡æ‰‘åŠ¨æ—¶é•¿
    let currentFlutterDuration = 4.0; // å½“å‰æ‰‘åŠ¨æ—¶é•¿
    let lastUpdateTime = Date.now();

    function updateWingFlutterToHeartRate() {
      const heartRateElement = document.getElementById('hr');
      const heartRate = parseFloat(heartRateElement.textContent);
      const currentTime = Date.now();

      // è®¡ç®—ç›®æ ‡æ‰‘åŠ¨é€Ÿåº¦ï¼šä½¿ç”¨0.5å€å¿ƒç‡é¢‘ç‡ï¼Œè®©æ‰‘åŠ¨æ›´åƒè‡ªç„¶å‘¼å¸
      // å¿ƒç‡69bpm -> æ‰‘åŠ¨é¢‘ç‡çº¦17æ¬¡/åˆ† -> æ¯3.5ç§’æ‰‘åŠ¨ä¸€æ¬¡
      targetFlutterDuration = (60 / heartRate) * 4;

      // æ·»åŠ å‘¼å¸ç›¸ä½å½±å“ï¼Œè®©æ‰‘åŠ¨æ›´æœ‰æœº
      const breathInfluence = Math.sin(breathingPhase) * 0.25; // Â±25%çš„å‘¼å¸å½±å“
      targetFlutterDuration *= (1 + breathInfluence);

      // éå¸¸ç¼“æ…¢çš„è¿‡æ¸¡ï¼Œæ¨¡æ‹ŸçœŸå®çš„ç”Ÿç†é€‚åº”
      const deltaTime = (currentTime - lastUpdateTime) / 1000; // è½¬æ¢ä¸ºç§’
      const transitionSpeed = 0.008 * deltaTime; // åŸºäºæ—¶é—´çš„è¿‡æ¸¡é€Ÿåº¦
      currentFlutterDuration += (targetFlutterDuration - currentFlutterDuration) * transitionSpeed;

      // é™åˆ¶åœ¨èˆ’ç¼“çš„èŒƒå›´å†…ï¼ˆ2-6ç§’ï¼‰
      currentFlutterDuration = Math.max(2.5, Math.min(6.0, currentFlutterDuration));

      // æ·»åŠ å¾®å°çš„éšæœºå˜åŒ–ï¼Œæ¨¡æ‹Ÿè‡ªç„¶çš„ä¸è§„å¾‹æ€§
      const naturalVariation = 1 + (Math.sin(currentTime / 7000) * 0.1); // 7ç§’å‘¨æœŸçš„è½»å¾®å˜åŒ–
      const finalDuration = currentFlutterDuration * naturalVariation;

      // æ›´æ–°CSSå˜é‡
      document.documentElement.style.setProperty('--wing-speed', `${finalDuration}s`);
      lastUpdateTime = currentTime;
    }

    // æ·»åŠ çœŸå®çš„å¿ƒç‡å˜å¼‚æ€§
    function addRealisticHeartRateVariability() {
      setInterval(() => {
        const baseHeartRate = 69; // åŸºå‡†å¿ƒç‡
        const currentTime = Date.now();

        // å‘¼å¸æ€§çª¦æ€§å¿ƒå¾‹ä¸é½
        const breathCycleDuration = (60 / currentBreathRate) * 1000;
        breathingPhase = ((currentTime % breathCycleDuration) / breathCycleDuration) * 2 * Math.PI;
        const respiratoryVariation = Math.sin(breathingPhase) * 2; // Â±2 bpm

        // è‡ªç„¶å¿ƒç‡å˜å¼‚æ€§
        const hrv = (Math.random() - 0.5) * 3; // Â±1.5 bpmçš„éšæœºå˜åŒ–

        // é•¿æœŸè¶‹åŠ¿å˜åŒ–
        const longTermTrend = Math.sin(currentTime / 25000) * 1.5; // 25ç§’å‘¨æœŸ

        // è®¡ç®—æœ€ç»ˆå¿ƒç‡
        const finalHeartRate = Math.max(50, Math.min(100,
          baseHeartRate + respiratoryVariation + hrv + longTermTrend
        ));

        currentHeartRate = finalHeartRate;

        // æ›´æ–°æ˜¾ç¤ºï¼ˆä¿ç•™1ä½å°æ•°ï¼‰
        document.getElementById('hr').textContent = finalHeartRate.toFixed(1);

        // å®æ—¶æ›´æ–°ç¿…è†€æ‰‘åŠ¨é€Ÿåº¦
        updateWingFlutterToHeartRate();

        // æ›´æ–°æ™ºèƒ½æ ‡é¢˜
        updateSmartHeadline(finalHeartRate);

      }, 200); // æ¯200msæ›´æ–°ä¸€æ¬¡
    }

    // å¢å¼ºçš„å‘¼å¸é¢‘ç‡å˜å¼‚æ€§
    function addEnhancedBreathingVariability() {
      setInterval(() => {
        const baseBreathRate = 18;

        // æ·±åº¦å‘¼å¸å‘¨æœŸå˜åŒ–ï¼ˆæ¨¡æ‹Ÿæ·±æµ…å‘¼å¸äº¤æ›¿ï¼‰
        const deepBreathCycle = Math.sin(Date.now() / 15000) * 1.2; // 15ç§’å‘¨æœŸ

        // ä¸å¿ƒç‡çš„ç”Ÿç†è€¦åˆ
        const heartRateCoupling = (currentHeartRate - 69) * 0.05;

        // ç¡çœ çŠ¶æ€å½±å“ï¼ˆæ¨¡æ‹Ÿæ·±ç¡æ—¶å‘¼å¸æ›´æ…¢æ›´è§„å¾‹ï¼‰
        const sleepEffect = Math.sin(Date.now() / 120000) * -0.8; // 2åˆ†é’Ÿå‘¨æœŸï¼Œæ¨¡æ‹Ÿç¡çœ æ·±åº¦å˜åŒ–

        // è‡ªç„¶éšæœºå˜åŒ–
        const naturalVariation = (Math.random() - 0.5) * 1.2;

        // å‘¼å¸ç›¸ä½åŒæ­¥æ•ˆåº”
        const breathPhaseEffect = Math.cos(breathingPhase * 0.5) * 0.3;

        const finalBreathRate = Math.max(12, Math.min(24,
          baseBreathRate + deepBreathCycle + heartRateCoupling + sleepEffect + naturalVariation + breathPhaseEffect
        ));

        currentBreathRate = finalBreathRate;
        document.getElementById('br').textContent = finalBreathRate.toFixed(1);

      }, 2000); // æ¯2ç§’æ›´æ–°å‘¼å¸é¢‘ç‡
    }

    // ç¡çœ æ•°æ®ç®¡ç†
    let sleepData = {
      sleepTime: "11:08 pm",
      wakeWindow: "6:40â€“7:10 am",
      duration: "7h 32m",
      deepSleep: "1h 32m",
      timeToSleep: "13m"
    };

    // æ™ºèƒ½æ ‡é¢˜æ¶ˆæ¯åº“ï¼ˆå¸¦æƒ…æ„Ÿemojiï¼‰
    const smartMessages = {
      detecting: [
        "ğŸ‘€ I can sense you're here",
        "ğŸ” Lunawake is monitoring your vitals",
        "ğŸ“¡ Your presence detected",
        "âš™ï¸ Calibrating to your rhythm"
      ],
      restful: [
        "ğŸ˜Œ Your heart is calm tonight",
        "ğŸ’š Perfect resting heart rate",
        "âœ¨ You're ready for deep sleep",
        "ğŸ’ Beautiful steady rhythm",
        "ğŸŒ¸ Your body is settling down"
      ],
      elevated: [
        "ğŸ’“ Your heart is beating fast tonight",
        "ğŸ˜° Sensing some restlessness",
        "ğŸ« Take a deep breath and relax",
        "âš¡ Your pulse seems elevated",
        "ğŸ˜” Maybe some stress from today?"
      ],
      active: [
        "ğŸ¤” Are you getting up for something?",
        "ğŸ‘ï¸ I see you're moving around",
        "ğŸš¶ Back from the bathroom?",
        "ğŸ˜Š Can't sleep? That's okay",
        "âš¡ Your heart rate suggests you're awake"
      ],
      leaving: [
        "ğŸšª Are you heading out?",
        "ğŸŒ… Going to start your day?",
        "ğŸ  I'll be here when you return",
        "ğŸ’¼ Off to work already?",
        "â˜€ï¸ Have a great day ahead"
      ],
      returning: [
        "ğŸ¤— Welcome back to bed",
        "ğŸ˜´ Ready to wind down again?",
        "ğŸ’¤ Let's get you back to sleep",
        "ğŸ›ï¸ Settling in for the night",
        "ğŸ“‰ Your heart rate is stabilizing"
      ],
      irregular: [
        "ğŸŒŠ Your rhythm seems unsettled tonight",
        "ğŸ“ˆ Sensing some irregular patterns",
        "ğŸ« Maybe try some breathing exercises",
        "ğŸ’ª Your heart is working harder tonight",
        "ğŸ§˜ Let's help you find your calm"
      ],
      peaceful: [
        "ğŸŒ™ You're drifting into peaceful sleep",
        "ğŸ˜‡ Your breathing is so calm",
        "ğŸ§˜â€â™€ï¸ Deep relaxation detected",
        "ğŸ’†â€â™€ï¸ Your body knows how to rest",
        "âœ¨ Sweet dreams are coming"
      ]
    };

    let currentMessageCategory = "detecting";
    let lastHeartRatePattern = [];
    let messageChangeTimer = 0;

    // åŸºäºå¿ƒç‡æ¨¡æ‹Ÿç¡çœ æ•°æ®çš„ç¼“æ…¢å˜åŒ–
    function simulateSleepDataBasedOnHeartRate() {
      setInterval(() => {
        const avgHeartRate = currentHeartRate;

        // æ ¹æ®å¿ƒç‡è®¡ç®—ç¡çœ è´¨é‡æŒ‡æ ‡
        const heartRateStress = Math.abs(avgHeartRate - 65); // 65æ˜¯ç†æƒ³ç¡çœ å¿ƒç‡
        const sleepQuality = Math.max(0.3, 1 - heartRateStress / 30); // 0.3-1.0

        // åŠ¨æ€è°ƒæ•´æ·±ç¡æ—¶é—´ï¼ˆå¿ƒç‡è¶Šç¨³å®šï¼Œæ·±ç¡è¶Šå¤šï¼‰
        const baseDeepSleep = 92; // åŸºç¡€92åˆ†é’Ÿ
        const deepSleepVariation = (sleepQuality - 0.5) * 40; // Â±20åˆ†é’Ÿ
        const finalDeepSleep = Math.max(45, Math.min(140, baseDeepSleep + deepSleepVariation));

        const deepHours = Math.floor(finalDeepSleep / 60);
        const deepMinutes = Math.round(finalDeepSleep % 60);
        sleepData.deepSleep = `${deepHours}h ${deepMinutes}m`;

        // åŠ¨æ€è°ƒæ•´å…¥ç¡æ—¶é—´ï¼ˆå¿ƒç‡è¶Šä½è¶Šå¿«å…¥ç¡ï¼‰
        const baseTTS = 13; // åŸºç¡€13åˆ†é’Ÿ
        const ttsVariation = (avgHeartRate - 65) * 0.3; // å¿ƒç‡æ¯é«˜1bpmå¤š0.3åˆ†é’Ÿ
        const finalTTS = Math.max(3, Math.min(25, baseTTS + ttsVariation));
        sleepData.timeToSleep = `${Math.round(finalTTS)}m`;

        // åŠ¨æ€è°ƒæ•´æ€»ç¡çœ æ—¶é•¿
        const baseDuration = 452; // åŸºç¡€7h32m = 452åˆ†é’Ÿ
        const durationVariation = sleepQuality * 30 - 15; // Â±15åˆ†é’Ÿ
        const finalDuration = Math.max(360, Math.min(540, baseDuration + durationVariation));

        const totalHours = Math.floor(finalDuration / 60);
        const totalMinutes = Math.round(finalDuration % 60);
        sleepData.duration = `${totalHours}h ${totalMinutes}m`;

        // æ›´æ–°æ˜¾ç¤º
        document.getElementById('deepSleep').textContent = sleepData.deepSleep;
        document.getElementById('tts').textContent = sleepData.timeToSleep;
        document.getElementById('duration').textContent = sleepData.duration;

      }, 15000); // æ¯15ç§’æ›´æ–°ä¸€æ¬¡ç¡çœ æ•°æ®
    }

    // æ¨¡æ‹Ÿæ—¶é—´ç›¸å…³çš„ç¡çœ æ•°æ®å˜åŒ–ï¼ˆéå®æ—¶ä½†æœ‰è§„å¾‹ï¼‰
    function simulateTimeBasedSleepUpdates() {
      setInterval(() => {
        const now = new Date();
        const currentMinutes = now.getHours() * 60 + now.getMinutes();

        // æ¨¡æ‹Ÿç¡çœ æ—¶é—´çš„å¾®è°ƒï¼ˆåŸºäºå½“å‰å¿ƒç‡è¶‹åŠ¿ï¼‰
        const heartRateTrend = (currentHeartRate - 69) / 10; // æ ‡å‡†åŒ–å¿ƒç‡è¶‹åŠ¿

        // ç¡çœ æ—¶é—´å¾®è°ƒï¼ˆÂ±5åˆ†é’ŸèŒƒå›´ï¼‰
        const baseHour = 23;
        const baseMinute = 8;
        const timeAdjustment = Math.round(heartRateTrend * 3); // Â±3åˆ†é’Ÿè°ƒæ•´

        let adjustedMinute = baseMinute + timeAdjustment;
        let adjustedHour = baseHour;

        if (adjustedMinute < 0) {
          adjustedMinute += 60;
          adjustedHour -= 1;
        } else if (adjustedMinute >= 60) {
          adjustedMinute -= 60;
          adjustedHour += 1;
        }

        // æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤º
        const sleepTimeStr = `${adjustedHour === 12 ? 12 : adjustedHour % 12}:${adjustedMinute.toString().padStart(2, '0')} ${adjustedHour >= 12 ? 'pm' : 'am'}`;
        sleepData.sleepTime = sleepTimeStr;

        // ç›¸åº”è°ƒæ•´å”¤é†’çª—å£
        const wakeHour = 6 + Math.round(timeAdjustment / 10); // å¾®è°ƒå”¤é†’æ—¶é—´
        const wakeEndHour = wakeHour + 1;
        sleepData.wakeWindow = `${wakeHour}:40â€“${wakeEndHour}:10 am`;

        // æ›´æ–°æ˜¾ç¤º
        document.getElementById('sleepTime').textContent = sleepData.sleepTime;
        document.getElementById('wakeWindow').textContent = sleepData.wakeWindow;

      }, 45000); // æ¯45ç§’æ›´æ–°ä¸€æ¬¡æ—¶é—´ç›¸å…³æ•°æ®
    }

    // æ™ºèƒ½æ ‡é¢˜æ›´æ–°ç³»ç»Ÿ
    function updateSmartHeadline(currentHR) {
      // è®°å½•å¿ƒç‡æ¨¡å¼ç”¨äºåˆ†æ
      lastHeartRatePattern.push(currentHR);
      if (lastHeartRatePattern.length > 20) {
        lastHeartRatePattern.shift(); // ä¿æŒæœ€è¿‘20ä¸ªæ•°æ®ç‚¹
      }

      messageChangeTimer++;

      // æ¯30æ¬¡æ›´æ–°(çº¦6ç§’)åˆ†æä¸€æ¬¡æ¨¡å¼å¹¶å¯èƒ½æ›´æ¢æ¶ˆæ¯
      if (messageChangeTimer >= 30) {
        messageChangeTimer = 0;
        analyzeHeartRatePattern();
      }
    }

    function analyzeHeartRatePattern() {
      if (lastHeartRatePattern.length < 10) return;

      const recentHR = lastHeartRatePattern.slice(-10);
      const avgHR = recentHR.reduce((a, b) => a + b, 0) / recentHR.length;
      const hrVariability = Math.max(...recentHR) - Math.min(...recentHR);
      const trend = recentHR[recentHR.length - 1] - recentHR[0];

      let newCategory = currentMessageCategory;

      // åˆ†æç”¨æˆ·çŠ¶æ€
      if (avgHR < 55) {
        newCategory = "peaceful";
      } else if (avgHR < 65 && hrVariability < 5) {
        newCategory = "restful";
      } else if (avgHR > 85) {
        if (trend > 5) {
          newCategory = "active"; // å¿ƒç‡ä¸Šå‡è¶‹åŠ¿
        } else if (trend < -5) {
          newCategory = "returning"; // å¿ƒç‡ä¸‹é™è¶‹åŠ¿
        } else {
          newCategory = "elevated";
        }
      } else if (avgHR > 95) {
        newCategory = "leaving"; // å¾ˆé«˜å¿ƒç‡ï¼Œå¯èƒ½åœ¨æ´»åŠ¨
      } else if (hrVariability > 15) {
        newCategory = "irregular";
      } else if (avgHR >= 65 && avgHR <= 75 && hrVariability < 8) {
        newCategory = "restful";
      }

      // å¦‚æœçŠ¶æ€æ”¹å˜ï¼Œæ›´æ–°æ¶ˆæ¯
      if (newCategory !== currentMessageCategory || Math.random() > 0.7) {
        currentMessageCategory = newCategory;
        updateHeadlineMessage();
      }
    }

    function updateHeadlineMessage() {
      const messages = smartMessages[currentMessageCategory];
      const randomMessage = messages[Math.floor(Math.random() * messages.length)];

      const headlineElement = document.getElementById('headline');

      // æ·»åŠ æ·¡å‡ºæ•ˆæœ
      headlineElement.style.opacity = '0.3';
      headlineElement.style.transform = 'translateX(-50%) translateY(-5px)';

      setTimeout(() => {
        headlineElement.textContent = randomMessage;
        // æ·¡å…¥æ•ˆæœ
        headlineElement.style.opacity = '1';
        headlineElement.style.transform = 'translateX(-50%) translateY(0)';
      }, 800);
    }

    // åˆå§‹åŒ–æ‰€æœ‰åŠŸèƒ½
    updateWingFlutterToHeartRate();
    addRealisticHeartRateVariability();
    addEnhancedBreathingVariability();
    simulateSleepDataBasedOnHeartRate();
    simulateTimeBasedSleepUpdates();

    // åˆå§‹è®¾ç½®ä¸€ä¸ªæ¶ˆæ¯
    setTimeout(() => {
      updateHeadlineMessage();
    }, 1000);
  </script>
</body>
</html>